{% extends "base.html" %}

{% block title %}Dashboard - SmartBank{% endblock %}

{% block head %}
    {{ super() }}
    <script>
        // Force reload when back button is used to prevent stale pages
        window.addEventListener('pageshow', function (event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                window.location.reload();
            }
        });
    </script>
{% endblock %}

{% block content %}
    {% if current_user.is_staff %}
        <h2>Staff Dashboard</h2>
        <p>Welcome, {{ username }}</p>
        <!-- Staff-specific content can go here -->
    {% else %}
        {% if session.get('lang') == 'hi' %}
        <h2>‡§®‡§Æ‡§∏‡•ç‡§§‡•á, {{ username }}</h2>
        {% elif session.get('lang') == 'ta' %}
        <h2>‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, {{ username }}</h2>
        {% elif session.get('lang') == 'te' %}
        <h2>‡∞®‡∞Æ‡∞∏‡±ç‡∞§‡±á, {{ username }}</h2>
        {% elif session.get('lang') == 'kn' %}
        <h2>‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞, {{ username }}</h2>
        {% elif session.get('lang') == 'ml' %}
        <h2>‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç, {{ username }}</h2>
        {% else %}
        <h2>Hello, {{ username }}</h2>
        {% endif %}

        {% if account_number %}
            <p>Account Number: {{ account_number }}</p>
            <p><strong>üíµ Usable Balance:</strong> ‚Çπ{{ "%.2f"|format(usable_balance) }}</p>
            <p><strong>üîí Smart Saver (Goal Savings):</strong> ‚Çπ{{ "%.2f"|format(goal_savings) }}</p>
            <hr>
            <p><strong>üßæ Total Balance:</strong> ‚Çπ{{ "%.2f"|format(balance) }}</p>

            <!-- üëá Deposit, Withdraw, Transfer Buttons -->
            <div class="mt-4">
                <a href="{{ url_for('main.deposit') }}" class="btn btn-success me-2">Deposit</a>
                <a href="{{ url_for('main.withdraw') }}" class="btn btn-warning me-2">Withdraw</a>
                <a href="{{ url_for('main.transfer') }}" class="btn btn-primary">Transfer</a>
            </div>

        {% else %}
            <p>No account found.</p>
        {% endif %}
    {% endif %}
{% endblock %}
